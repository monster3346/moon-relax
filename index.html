<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>XemPhimHay - Đồ án tốt nghiệp</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <style>
    :root {
      --primary: #e50914;
      --dark: #141414;
      --light: #f5f5f1;
    }
    body { background: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; }
    .navbar { background: #000 !important; box-shadow: 0 2px 10px rgba(0,0,0,0.5); }
    .card { background: #1f1f1f; border: none; transition: 0.3s; cursor: pointer; }
    .card:hover { transform: translateY(-8px); box-shadow: 0 10px 20px rgba(229, 9, 20, 0.3); }
    .card-img-top { height: 280px; object-fit: cover; }
    .badge-rating { background: var(--primary); }
    .search-box input { border-radius: 30px; padding-left: 40px; }
    .search-box i { position: absolute; left: 12px; top: 12px; color: #999; }
    .movie-modal .modal-content { background: #000; }
    .video-container { position: relative; padding-bottom: 56.25%; height: 0; }
    .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark sticky-top">
  <div class="container">
    <a class="navbar-brand fw-bold fs-4" href="#"><i class="fas fa-film text-danger"></i> XemPhimHay</a>
    <div class="search-box position-relative mx-auto" style="max-width: 500px;">
      <i class="fas fa-search"></i>
      <input type="text" id="searchInput" class="form-control" placeholder="Tìm phim... (VD: Avengers)">
    </div>
    <button class="btn btn-outline-light d-none d-lg-block" data-bs-toggle="modal" data-bs-target="#loginModal">
      <i class="fas fa-user"></i> Đăng nhập
    </button>
  </div>
</nav>

<!-- Hero Banner -->
<div class="container-fluid p-0">
  <div id="heroBanner" class="position-relative text-white" style="height: 70vh; overflow: hidden;">
    <img id="bannerImg" src="" class="w-100 h-100" style="object-fit: cover; filter: brightness(0.4);">
    <div class="position-absolute bottom-0 start-0 p-5" style="max-width: 600px;">
      <h1 id="bannerTitle" class="display-4 fw-bold">Loading...</h1>
      <p id="bannerOverview" class="lead"></p>
      <button class="btn btn-danger btn-lg" onclick="playFeatured()">
        <i class="fas fa-play"></i> Xem ngay
      </button>
    </div>
  </div>
</div>

<!-- Danh sách phim -->
<div class="container my-5">
  <h2 class="mb-4"><i class="fas fa-fire text-danger"></i> Phim Đang Hot</h2>
  <div id="movies" class="row"></div>
</div>

<!-- Modal Trailer -->
<div class="modal fade movie-modal" id="trailerModal" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title text-white" id="movieTitle">Trailer</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-0">
        <div class="video-container">
          <iframe id="trailerFrame" frameborder="0" allowfullscreen></iframe>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Login (giả lập) -->
<div class="modal fade" id="loginModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5>Đăng nhập</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="text-center">Tính năng sẽ được thêm ở Tuần 3!</p>
      </div>
    </div>
  </div>
</div>

<script>
  const API_KEY = '15d2ea6d0dc1d476efbca3eba2b9bbfb';
  const BASE_URL = 'https://api.themoviedb.org/3';
  const IMG_URL = 'https://image.tmdb.org/t/p/w1280';
  const YOUTUBE = 'https://www.youtube.com/embed/';

  let featuredMovie = null;

  // Lấy phim phổ biến
  async function loadPopular() {
    const res = await fetch(`${BASE_URL}/movie/popular?api_key=${API_KEY}&language=vi-VN&page=1`);
    const data = await res.json();
    displayMovies(data.results.slice(0, 12));
    setFeatured(data.results[0]);
  }

  // Đặt phim nổi bật
  function setFeatured(movie) {
    featuredMovie = movie;
    document.getElementById('bannerImg').src = IMG_URL + movie.backdrop_path;
    document.getElementById('bannerTitle').innerText = movie.title;
    document.getElementById('bannerOverview').innerText = movie.overview || 'Không có mô tả.';
  }

  // Hiển thị danh sách phim
  function displayMovies(movies) {
    const container = document.getElementById('movies');
    container.innerHTML = '';
    movies.forEach(movie => {
      const col = document.createElement('div');
      col.className = 'col-6 col-md-3 col-lg-2 mb-4';
      col.innerHTML = `
        <div class="card h-100" onclick="showMovie(${movie.id})">
          <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" class="card-img-top" alt="${movie.title}">
          <div class="card-body p-2 text-center">
            <h6 class="card-title small text-truncate">${movie.title}</h6>
            <span class="badge bg-danger">★ ${movie.vote_average.toFixed(1)}</span>
          </div>
        </div>`;
      container.appendChild(col);
    });
  }

  // Xem chi tiết phim
  async function showMovie(id) {
    const res = await fetch(`${BASE_URL}/movie/${id}?api_key=${API_KEY}&append_to_response=videos&language=vi-VN`);
    const movie = await res.json();
    const trailer = movie.videos.results.find(v => v.type === 'Trailer' && v.site === 'YouTube');
    
    if (trailer) {
      document.getElementById('movieTitle').innerText = movie.title;
      document.getElementById('trailerFrame').src = YOUTUBE + trailer.key + '?autoplay=1';
      new bootstrap.Modal(document.getElementById('trailerModal')).show();
    } else {
      alert('Không có trailer cho phim này!');
    }
  }

  // Xem phim nổi bật
  function playFeatured() {
    if (featuredMovie) showMovie(featuredMovie.id);
  }

  // Tìm kiếm
  document.getElementById('searchInput').addEventListener('keypress', async e => {
    if (e.key === 'Enter') {
      const q = e.target.value.trim();
      if (!q) return loadPopular();
      const res = await fetch(`${BASE_URL}/search/movie?api_key=${API_KEY}&query=${q}&language=vi-VN`);
      const data = await res.json();
      displayMovies(data.results);
    }
  });

  // Modal đóng → dừng video
  document.getElementById('trailerModal').addEventListener('hidden.bs.modal', () => {
    document.getElementById('trailerFrame').src = '';
  });

  // Khởi chạy
  loadPopular();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
